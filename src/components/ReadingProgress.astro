---
---

<div
  class="fixed top-0 left-0 w-full h-1 z-50"
  data-testid="reading-progress"
  role="progressbar"
  aria-valuemin="0"
  aria-valuemax="100"
  aria-valuenow="0"
  aria-label="Reading progress"
>
  <div
    class="h-full bg-compass-gold transition-none"
    data-progress-bar
    style="width: 0%"
  >
  </div>
</div>

<script>
  const container = document.querySelector('[data-testid="reading-progress"]');
  const bar = document.querySelector("[data-progress-bar]") as HTMLElement;
  const article = document.querySelector("[data-testid='article-content']");

  if (container && bar && article) {
    const prefersReducedMotion = window.matchMedia(
      "(prefers-reduced-motion: reduce)",
    ).matches;

    if (!prefersReducedMotion) {
      let ticking = false;

      window.addEventListener("scroll", () => {
        if (!ticking) {
          window.requestAnimationFrame(() => {
            const articleRect = article.getBoundingClientRect();
            const articleTop =
              articleRect.top + window.scrollY;
            const articleHeight = articleRect.height;
            const scrolled = window.scrollY - articleTop;
            const windowHeight = window.innerHeight;
            const progress = Math.min(
              100,
              Math.max(
                0,
                (scrolled / (articleHeight - windowHeight)) * 100,
              ),
            );

            bar.style.width = `${progress}%`;
            container.setAttribute(
              "aria-valuenow",
              String(Math.round(progress)),
            );
            ticking = false;
          });
          ticking = true;
        }
      });
    }
  }
</script>
