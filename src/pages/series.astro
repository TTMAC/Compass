---
import PageLayout from "@layouts/PageLayout.astro";
import { getCollection } from "astro:content";

const articles = await getCollection("articles");

const partTitles: Record<number, string> = {
  1: "The Architecture",
  2: "The Money",
  3: "The Accountability",
  4: "The Participation",
  5: "The Assessment",
};

const articlesByPart = [1, 2, 3, 4, 5].map((part) => ({
  part,
  title: partTitles[part],
  articles: articles
    .filter((a) => a.data.part === part)
    .sort((a, b) => a.data.articleNumber.localeCompare(b.data.articleNumber)),
}));

const sphereColors: Record<string, string> = {
  national: "bg-sphere-national",
  provincial: "bg-sphere-provincial",
  municipal: "bg-sphere-municipal",
};
---

<PageLayout
  title="Series"
  description="All 15 articles in the Compass series, organised by part. Understanding South Africa's governance from architecture to accountability."
>
  <h1 class="font-heading text-3xl font-bold text-text-primary mb-2">
    The Series
  </h1>
  <p class="text-text-secondary mb-10">
    15 articles across 5 parts. Read in order, or jump to what interests you.
  </p>

  <div class="space-y-10">
    {
      articlesByPart.map(({ part, title, articles }) => (
        <section>
          <h2 class="font-heading text-xl font-bold text-text-primary mb-4">
            Part {part}: {title}
          </h2>

          {articles.length > 0 ? (
            <div class="space-y-3">
              {articles.map((article) => (
                <a
                  href={
                    article.data.status === "published"
                      ? `/articles/${article.id.replace(/\.md$/, "")}`
                      : undefined
                  }
                  class={`block border border-gray-200 rounded-lg p-4 transition-colors ${
                    article.data.status === "published"
                      ? "hover:border-compass-green cursor-pointer"
                      : "opacity-60 cursor-default"
                  }`}
                >
                  <div class="flex items-start justify-between gap-4">
                    <div>
                      <div class="flex items-center gap-2 mb-1">
                        <span class="font-heading text-xs text-text-secondary">
                          {article.data.articleNumber}
                        </span>
                        <span
                          class={`inline-block px-1.5 py-0.5 text-[10px] font-heading font-semibold text-white rounded ${sphereColors[article.data.sphere]}`}
                        >
                          {article.data.sphere.charAt(0).toUpperCase() +
                            article.data.sphere.slice(1)}
                        </span>
                        {article.data.status === "coming-soon" && (
                          <span class="text-[10px] font-heading text-text-secondary bg-bg-secondary px-1.5 py-0.5 rounded">
                            Coming soon
                          </span>
                        )}
                      </div>
                      <h3 class="font-heading text-base font-semibold text-text-primary">
                        {article.data.title}
                      </h3>
                    </div>
                    {article.data.status === "published" && (
                      <span class="font-heading text-xs text-text-secondary whitespace-nowrap">
                        {article.data.readingTime} min
                      </span>
                    )}
                  </div>
                </a>
              ))}
            </div>
          ) : (
            <p class="text-sm text-text-secondary italic">
              Articles coming soon.
            </p>
          )}
        </section>
      ))
    }
  </div>
</PageLayout>
